
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous">
    var triggerTabList = [].slice.call(document.querySelectorAll('#myTab a'))
        triggerTabList.forEach(function (triggerEl) {
        var tabTrigger = new bootstrap.Tab(triggerEl)

        triggerEl.addEventListener('click', function (event) {
            event.preventDefault()
            tabTrigger.show()
            })  
        })
    </script>
    <script>
        function mostrartab(id){
            var someTabTriggerEl = document.getElementById(id)
            var tab = new bootstrap.Tab(someTabTriggerEl)
            tab.show()
        }
        function agregarFila(){
            document.getElementById("tabla1").insertRow(-1).innerHTML = '<tr><td>'+document.getElementById("Nomride").value+'</td><td>'+document.getElementById("Salida").value+'</td><td>'+document.getElementById("Destino").value+'</td><td><button class="btn btn-primary" type="button" role="tab" onclick="cargarRide(this),Fila(this),mostrartab(\''+'Rides-tab'+'\'),EditarAgregar(\''+'Editar'+'\')">Editar</button> <button class="btn btn-primary" onclick="pregunta(this)">Borrar</button> <button class="btn btn-primary" type="button" id="RidesReadonly-tab" onclick="cargarRide(this),readonly(),mostrartab(\''+'Rides-tab'+'\')" >ver</button></td></tr>';
        }
        function pintar(){
            var a = new Array();
            a = JSON.parse(sessionStorage.getItem('Usuarios'));
            var g = sessionStorage.getItem('usuarioactivo');
            for (let i = 0; i < a.length; i++) {
                if(g === a[i].NamUsuario){
                    for (let f = 0; f < a[i].Viajes.length; f++) {
                        document.getElementById("tabla1").insertRow(-1).innerHTML = '<tr><td>'+a[i].Viajes[f].Nombre+'</td><td>'+a[i].Viajes[f].Salida+'</td><td>'+a[i].Viajes[f].Destino+'</td><td><button class="btn btn-primary" type="button" role="tab" onclick="cargarRide(this),Fila(this),mostrartab(\''+'Rides-tab'+'\'),EditarAgregar(\''+'Editar'+'\')">Editar</button> <button class="btn btn-primary" onclick="pregunta(this)">Borrar</button> <button class="btn btn-primary" type="button" id="RidesReadonly-tab" onclick="cargarRide(this),readonly(),mostrartab(\''+'Rides-tab'+'\')" >ver</button></td></tr>';
                    }    
                }
            }
        }
        function posicionUsuario(){
            var a = new Array();
            a = JSON.parse(sessionStorage.getItem('Usuarios'));
            var g = sessionStorage.getItem('usuarioactivo');
                var posicion = 0;
                for (let j = 0; j < a.length; j++) {
                    if(g === a[j].NamUsuario){
                       posicion = j;
                    }
                }
                return posicion
        }
        function editarViaje(){
            var a = new Array();
            a = JSON.parse(sessionStorage.getItem('Usuarios'));
            var fila = sessionStorage.getItem("fila");
            var posicion = posicionUsuario();
            var i = sessionStorage.getItem("fila")
            document.getElementById("tabla1").rows[i].cells[0].innerHTML = document.getElementById("Nomride").value;
            document.getElementById("tabla1").rows[i].cells[1].innerHTML = document.getElementById("Salida").value;
            document.getElementById("tabla1").rows[i].cells[2].innerHTML = document.getElementById("Destino").value;
        }
        
        function Fila(row){
            var d = row.parentNode.parentNode.rowIndex;
            sessionStorage.setItem("fila",d)
        }
        function guardar_localstorage(){
            var a = new Array();
            a = JSON.parse(sessionStorage.getItem('Usuarios'));
            var posicion = posicionUsuario();
            a[posicion].Viajes = new Array();
            for (let i = 1; i < document.getElementById("tabla1").rows.length; i++) {                
                let nombre = document.getElementById("tabla1").rows[i].cells[0].innerText;
                let salida = document.getElementById("tabla1").rows[i].cells[1].innerText;
                let destino = document.getElementById("tabla1").rows[i].cells[2].innerText;
                let h = new datostabla(nombre,salida,destino);
                a[posicion].Viajes.push(h)
            } 
            var b = new Array();
            for (let i = 0; i < a.length; i++) {
                let f = new RegUsuario(a[i].NamUsuario,a[i].Contraseña,a[i].Telefono,a[i].Nombre,a[i].Apellidos,a[i].Viajes);
                b.push(f);
            }
            sessionStorage.setItem("Usuarios",JSON.stringify(b)) 
        }
        function eliminar(row){
            var d = row.parentNode.parentNode.rowIndex;
            document.getElementById('tabla1').deleteRow(d);
        }
        function cargarRide(row){
            var d = row.parentNode.parentNode.rowIndex;
            var a = new Array();
            a = JSON.parse(sessionStorage.getItem('Usuarios'));
            var posicion = posicionUsuario();
            document.getElementById("Nomride").value = a[posicion].Viajes[d-1].Nombre;
            document.getElementById("Salida").value = a[posicion].Viajes[d-1].Salida;
            document.getElementById("Destino").value = a[posicion].Viajes[d-1].Destino;
        }
        function pregunta(id){
    if (confirm('¿Estas seguro que quiere borrar el viaje?')){
        eliminar(id)
    }
}
        function readonly(){
            var hijos = document.getElementById('form1').childNodes;
            var hijos2 = document.getElementById('centro').childNodes;
            var hijos3 = document.getElementById('form3').childNodes;
            for (let index = 0; index < hijos.length; index++) {
                var Rehijos = hijos[index].childNodes;
                for (let i = 0; i < Rehijos.length; i++) {
                    Rehijos[i].readOnly = true;
                    
                }
            }
            for (let a = 0; a < hijos2.length; a++) {
                hijos2[a].readOnly = true;
            }
            for (let a = 0; a < hijos3.length; a++) {
                hijos3[a].disabled = true;
            }
        }
        function datostabla(nombre,salida,destino){
            this.Nombre = nombre;
            this.Salida = salida; 
            this.Destino = destino;
        }
        function RegUsuario(namusuario,Contraseña,tel,nombre,apellidos,viajes){
            this.NamUsuario = namusuario;
            this.Contraseña = Contraseña;
            this.Telefono = tel;
            this.Nombre = nombre;
            this.Apellidos = apellidos;
            this.Viajes = viajes
        };
        function EditarAgregar(cambio){
            sessionStorage.setItem("Tipo",cambio)
        }
        function accion(){
            var tipo = sessionStorage.getItem("Tipo");
            if(tipo == "Editar"){
                editarViaje()
            }else{
                agregarFila()
            }
        }
        window.onload = function(){
            pintar();
        }
        window.onbeforeunload = function(){
            guardar_localstorage()
        }
        
    </script>
    <title>TicoRides</title>
  </head>
  <body>
    <div class="contendor">
        <a href="C:\Users\wilcr\OneDrive\Escritorio\UTN Software\Diseño de aplicaciones web\Programas\Proyecto 1\Publico\publico.html"><input type="button" class="btn btn-primary" onclick="guardar_localstorage()" value="Cerrar sesion" name="Cerrar sesion" id="btnCerrar"></a>
            <ul class="nav nav-tabs justify-content-center" role="tablist">
                <li class="nav-item " role="presentation">
                    <button class="nav-link active btn-primary" id="Dashboard-tab" data-bs-toggle="tab" data-bs-target="#Dashboard" type="button" role="tab" aria-controls="Dashboard" aria-selected="true">Home</button></li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link btn-primary" id="Rides-tab" data-bs-toggle="tab" data-bs-target="#Rides" type="button" role="tab" aria-controls="Rides" aria-selected="false" >Rides</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link btn btn-primaRides-tabry" id="Configuraciones-tab" data-bs-toggle="tab" data-bs-target="#Configuraciones" type="button" role="tab" aria-controls="Configuraciones" aria-selected="false">Configuraciones</button></li>
            </ul>
         <div class="tab-content">
             <!--Div que contine el tab de dashboard-->
             
             <div class="tab1 tab-pane active" id="Dashboard" role="tabpanel" aria-labelledby="Dashboard-tab">
                 <h2>Dashboard</h2>
                 <h4>Mis Rides</h4><br>
                 <button class="btn btn-primary" type="button" role="tab" onclick="mostrartab('Rides-tab'),EditarAgregar('Agregar')">Agregar</button><br><br>
                 <form id="table">
                     <table border="1" id="tabla1"  class="container table table-bordered">
                         <tr>
                             <th>Nombre</th>
                             <th>Salida</th>
                             <th>Destino</th>
                             <th>Acciones</th>
                         </tr>
                     </table>
                 </form>
             </div>
 
             <!--Div que contiene el tab de las configuracion-->
    
             <div class="tab2 tab-pane" id="Configuraciones" role="tabpanel" aria-labelledby="Configuraciones-tab">
                 <h1>Configuraciones</h1>
                 <label for="nombre">Nombre completo</label><input type="text" name="Nombre" id="nombre"><br>
                 <label for="velocidad">Velocidad promedio</label><input type="number" name="Velocidad" id="velocidad" readonly><br>
                 <label for="acercademi">Descripcion</label><br><textarea name="Acercademi" id="acercademi"></textarea><br>
                 <input class="btn btn-primary" type="button" value="Guardar"> <input class="btn btn-primary" type="button" value="cancelar" >
             </div>
             <!--Div que contiene el tab de los rides-->
             
             <div class="tab3 tab-pane" id="Rides" role="tabpanel" aria-labelledby="Rides-tab">
                 <form id="form1" onsubmit="accion(),document.getElementById('form1').reset(),mostrartab('Dashboard-tab')">
                     <section class="form1">
                         <label for="Nomride" id="lblSalida">Nombre del ride</label><br><input type="text" name="salida" id="Nomride" required><br>
                             <section id="centro">
                                 <label for="Salida">Salida</label><input required type="text" name="" id="Salida"> <label for="Destino">Destino</label><input required type="text" name="" id="Destino">
                             </section>
                             <label for="descripcion">Descripcion</label><BR><textarea name="descripcion" id="descripcion"></textarea>
                     </section>
                     
                     <section id="form2">
                         <label for="Hsalida">Hora de salida</label><input type="time" name="hSalida" id="Hsalida" required><br>
                         <label for="Hllegada">Hora estimada de llegada</label><input type="time" name="hLlegada" id="Hllegada" required>
                     </section> 
                     <section id="form3">
                         <input type="checkbox" name="Lunes" id="dia"><label id="lbldia">Lunes</label><br>
                         <input type="checkbox" name="Martes" id="dia"><label id="lbldia">Martes</label><br>
                         <input type="checkbox" name="Miercoles" id="dia"><label id="lbldia">Miercoles</label><br>
                         <input type="checkbox" name="Jueves" id="dia"><label id="lbldia">Jueves</label><br>
                         <input type="checkbox" name="Viernes" id="dia"><label id="lbldia">Viernes</label><br>
                         <input type="checkbox" name="Sabado" id="dia"><label id="lbldia">Sabado</label><br>
                         <input type="checkbox" name="Domingo" id="dia"><label id="lbldia">Domingo</label><br>
                     </section>
                     <section class="form4">
                         <button class="btn btn-primary" type="button" onclick="document.getElementById('form1').reset(),mostrartab('Dashboard-tab')" >Cancelar</button> <button class="btn btn-primary" type="submit" >Aceptar</button>
                     </section>
                 </form>
             </div>
     </div>
    
  </body>
</html>